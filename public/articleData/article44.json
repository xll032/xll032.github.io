{
  "title":"cookie 介绍及使用",
  "type":16,
  "time":"2016/12/30 11:14",
  "content":"<p>1、cookie 概述</p><p>cookie 是浏览器提供的一种机制，它将 document 对象的 cookie 属性提供给 JavaScript。可以由 JavaScript 对其进行控制，而并不是 JavaScript 本身的性质。</p><p>cookie 是存于用户硬盘的一个文件，这个文件通常对应于一个域名，当浏览器再次访问这个域名时，可以使用这个 cookie。根据这一点，不难发现，cookie 只能在同一域名下的各网页中使用，不能跨域。</p><p>不同的浏览器对 cookie 的实现不一样，但其性质相同（例如存储位置，文件名等） </p><p>cookie机制将信息存储于用户硬盘，因此可作为全局变量使用。它可以用于以下几种场合：（还有更多的用途，比如：点赞等）</p><p>（1）保存用户登录状态。（下次访问可以省去登录操作。还可以设置登录超时的功能）</p><p>（2）跟踪用户行为。能够根据用户选择保存信息，让用户有种定制的感觉，且使用起来很方便</p><p>（3）定制页面。提供换肤或更换布局的功能，可以使用 cookie 来记录用户的选项</p><p>（4）创建购物车。记录用户需要购买的商品，结账的时候统一提交（例如淘宝）</p><p>cookie 的缺点主要集中于安全性和隐私保护。主要包括以下几种：</p><p>（1）可能被禁用。用户非常注重个人隐私保护时，很可能禁用浏览器的 cookie 功能</p><p>（2）与浏览器相关。访问同一个页面，不同浏览器之间所保存的 cookie 也不能互相访问 </p><p>（3）可能被删除。每个cookie都是硬盘上的文件，可能被用户删除</p><p>（4）安全性不够高。都是以纯文本的形式记录于文件中，如果要保存用户名密码等信息时，最好事先经过加密处理</p><p>2、cookie 设置 </p><p>（1）新增</p><pre class='code'><span class='spe'>document</span><span class='word'>.</span><span class='spe'>cookie</span><span class='key'> = </span><span class='str'>'usrId=888'</span><span class='word'>;</span></pre><p>这里有一点要说明，关于网上 cookie 介绍的博客非常多，基本是复制下来的，包括我前面的大多也是复制的。这导致了错误的说明广泛流传开来，我也踩进去了。小伙伴们也可以自己测试一下。下面做一些说明：</p><p>（a）如果要一次存储多个名/值对，可以使用分号加空格（; ）隔开。实测分号是需要的，空格有没有并没有什么影响（偷懒只测了 chrome，不放心的话，加个空格不碍事。值得一提的是，计入了 cookie 之后，从中读取 cookie 记录得到的字符串各属性之间是由分号加空格分隔的）</p><p>（b）还是同一句话，有的地方举例说：</p><pre class='code'><span class='spe'>document</span><span class='word'>.</span><span class='spe'>cookie</span><span class='key'>=</span><span class='str'>\"userId=828; userName=hulk\"</span><span class='word'>;</span><span class='com'>/* 这样的设置方式，只能成功设置第一个，后一个是无效的 */</span></pre><p>一次设置多个属性只能用于一个自定义属性和其他系统属性（如 expires），比如说：</p><pre class='code'><span class='spe'>document</span><span class='word'>.</span><span class='spe'>cookie</span><span class='key'>=</span><span class='str'>\"userId=828; expires=\"</span><span class='key'> + new </span><span class='fun'>Date</span><span class='word'>();</span><span class='com'>/* 这样的设置方式，过期时间也能生效 */</span></pre><p>要设置多个自定义属性的值，就必须分开写，例如：</p><pre class='code'><span class='spe'>document</span><span class='word'>.</span><span class='spe'>cookie</span><span class='key'>=</span><span class='str'>\"userId=888; expires=\"</span><span class='key'> + new </span><span class='fun'>Date</span><span class='word'>();</span><br><span class='spe'>document</span><span class='word'>.</span><span class='spe'>cookie</span><span class='key'>=</span><span class='str'>\"userName=John; expires=\"</span><span class='key'> + new </span><span class='fun'>Date</span><span class='word'>();</span></pre><p>（2）修改/添加</p><p>代码就不写了，修改就是相同名字的 cookie 重新赋值，新增就是写一个原来没有的。</p><p>（3）获取</p><p>上面描述的特点决定 cookie 只有一条的性质，使用 document.cookie 会得到所有cookie记录的字符串。需要用字符串分割split()，和数组的方法获取cookie的具体项。</p><p>此外，获取 cookie 的时候还会存在空格、中文乱码的情况，由于 cookie 内容是不确定的，所以在存入的时候就应该对中文、空格等情况做处理，可以使用 escape() 编码为16进制，获取后用 unescape() 解码并使用。（感觉用 encodeURI() 转成 utf-8 应该也可以，有兴趣可以试试看）</p><p>（4）设置有效时间</p><p>这是内置的一个属性，前面提前提到了。这里详细介绍一下。</p><p>cookie 默认是单会话 cookie，即浏览器关闭后这些 cookie 会丢失，因为它们只存在了内存中，而没有建立相应的磁盘文件。用 expires = time 设置有效期就可以记下这些 cookie，要设置10天有效期，就是把时间设置到10天之后。</p><p>（5）删除</p><p>只需将 cookie 的有效时间设置为过去的任一时间即可。</p><p>（6）指定可访问路径</p><pre class='code'><span class='spe'>document</span><span class='word'>.</span><span class='spe'>cookie</span><span class='key'> = </span><span class='str'>'userId=888; path=/'</span><span class='com'>// 全目录：/ ；指定目录：/dir</span></pre><p>（7）指定可访问主机名</p><p>默认情况下，不同主机名不能互相访问 cookie，可以使用 domain 参数实现控制，例如：www.google.com、gmail.google.com；m.baidu.com、www.baidu.com，如果要互相访问 cookie，可以这样写：</p><pre class='code'><span class='spe'>document</span><span class='word'>.</span><span class='spe'>cookie</span><span class='key'> = </span><span class='str'>'userId=888; domain=.google.com'</span><span class='com'>// baid同理：baidu.com </span></pre><p>3、实际使用</p><p>cookie 的操作比较复杂，实际使用的时候，构造函数来执行任务效率比较高。</p><p>（1）添加（添加的时候自己写其实也还好，就是可能会不太好看）</p><pre class='code'><span class='key'>function </span><span class='fun'>addCookie</span><span class='word'>(name,value,expiresHours)</span><span class='flower'>{</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class='key'>var </span><span class='param'>cookieString</span><span class='key'> = </span><span class='word'>name</span><span class='key'> + </span><span class='str'>'='</span><span class='key'> + </span><span class='fun'>escape</span><span class='word'>(value);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class='com'>// 判断过期时间</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class='key'>if</span><span class='word'>(expiresHours</span><span class='key'> > </span><span class='word'>0)</span><span class='flower'>{</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class='key'>var </span><span class='param'>date</span><span class='key'> = </span><span class='key'>new </span><span class='fun'>Date</span><span class='word'>();</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class='param'>date</span><span class='word'>.</span><span class='fun'>setTime</span><span class='word'>(</span><span class='param'>date</span><span class='word'>.</span><span class='fun'>getTime</span><span class='word'>()</span><span class='key'> + </span><span class='word'>expiresHours</span><span class='key'> * </span><span class='word'>3600</span><span class='key'> * </span><span class='word'>1000);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class='flower'>}</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class='spe'>document</span><span class='word'>.</span><span class='spe'>cookie</span><span class='key'> = </span><span class='param'>cookieString</span><span class='word'>;</span><br><span class='flower'>}</span></pre><p>（2）获取指定名称的 cookie 值（生成的 cookie 记录之间有一个空格，所以切分的时候要用“; ”）</p><pre class='code'><span class='key'>function </span><span class='fun'>getCookie</span><span class='word'>(name)</span><span class='flower'>{</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class='key'>var </span><span class='param'>strCookie</span><span class='key'> = </span><span class='spe'>document</span><span class='word'>.</span><span class='spe'>cookie</span><span class='word'>;</span><span class='com'>/* 'id=1; name=John; age=20; sex=1' */</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class='key'>var </span><span class='param'>arrCookie</span><span class='key'> = </span><span class='param'>strCookie</span><span class='word'>.</span><span class='method'>split</span><span class='word'>(</span><span class='str'>'; '</span><span class='word'>);</span><span class='com'>/* ['id=1','name=john','age=20','sex=1'] */</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class='key'>for</span><span class='word'>(</span><span class='key'>var </span><span class='param'>i</span><span class='key'> = </span><span class='word'>0;</span><span class='param'> i </span><span class='key'>< </span><span class='param'>arrCookie</span><span class='word'>.</span><span class='method'>length</span><span class='word'>;</span><span class='param'> i</span><span class='key'>++</span><span class='word'>)</span><span class='flower'>{</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class='key'>var </span><span class='param'>arr</span><span class='key'> = </span><span class='param'>arrCookie</span><span class='rect'>[</span><span class='param'>i</span><span class='rect'>]</span><span class='word'>.</span><span class='method'>split</span><span class='word'>(</span><span class='str'>'='</span><span class='word'>);</span><span class='com'>/* ['id','1'],['name','John'],['age','20'],['sex','1'] */</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class='key'>if</span><span class='word'>(</span><span class='param'> arr</span><span class='rect'>[</span><span class='word'>0</span><span class='rect'>]</span><span class='key'> == </span><span class='word'>name ) </span><span class='key'>return </span><span class='param'>arr</span><span class='rect'>[</span><span class='word'>1</span><span class='rect'>]</span><span class='word'>;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class='flower'>}</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class='key'>return </span><span class='str'>''</span><span class='word'>;</span><span class='com'>// 未找到，返回空字符串</span><br><span class='flower'>}</span></pre><p>（3）删除指定名称的 cookie 值（时间设置为过去即可）</p><pre class='code'><span class='key'>function </span><span class='fun'>delCookie</span><span class='word'>(name)</span><span class='flower'>{</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class='key'>var </span><span class='param'>date</span><span class='key'> = </span><span class='key'>new </span><span class='fun'>Date</span><span class='word'>();</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class='param'>date</span><span class='word'>.</span><span class='fun'>setTime</span><span class='word'>(</span><span class='param'>date</span><span class='word'>.</span><span class='method'>getTime</span><span class='word'>()</span><span class='key'> - </span><span class='word'>10000;</span><span class='com'> /* 这里减多少都行 */</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class='spe'>document</span><span class='word'>.</span><span class='spe'>cookie</span><span class='key'> = </span><span class='word'>name</span><span class='key'> + </span><span class='str'>'vvv;expires='</span><span class='key'> + </span><span class='param'>date</span><span class='word'>.</span><span class='method'>toGMTString</span><span class='word'>();</span><span class='com'>/* 这里vvv为值，值随便填一个就好了，马上就会被删掉 */</span><br><span class='flower'>}</span></pre>"
}